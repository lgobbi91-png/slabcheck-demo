<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SlabCheck - Test Ibrido</title>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #0f172a; color: white; text-align: center; margin: 0; }
        #camera { width: 100%; height: 40vh; object-fit: cover; border-bottom: 2px solid #38bdf8; }
        #controls { padding: 20px; background: #1e293b; }
        input { padding: 12px; border-radius: 8px; border: none; width: 60%; font-size: 1rem; margin-bottom: 10px; }
        button { padding: 12px 24px; border-radius: 8px; border: none; background: #38bdf8; color: white; font-weight: bold; cursor: pointer; }
        #result-box { padding: 30px; margin: 20px; border-radius: 15px; transition: 0.3s; background: #334155; }
        .safe { background: #16a34a !important; }
        .stolen { background: #dc2626 !important; animation: shake 0.5s; }
        @keyframes shake { 0%, 100% {transform: translateX(0);} 25% {transform: translateX(-10px);} 75% {transform: translateX(10px);} }
    </style>
</head>
<body>

    <video id="camera" autoplay playsinline></video>
    
    <div id="controls">
    <p style="margin-top:0;">Scansiona o inserisci manualmente:</p>
    <input type="text" id="manual-serial" placeholder="Es. 47281093">
    <button onclick="checkManual()">VERIFICA</button>
</div>
    
    <div id="result-box" id="result-ui">
        <h3 id="status">In attesa di dati...</h3>
        <p id="details">Inserisci il seriale per testare il database.</p>
    </div>

    <script>
        const video = document.getElementById('camera');
        const statusText = document.getElementById('status');
        const detailsText = document.getElementById('details');
        const resultBox = document.getElementById('result-box');
        const manualInput = document.getElementById('manual-serial');

        const BLACKLIST = ["47281093", "12345678"];

        // Funzione di verifica logica
        function checkDatabase(serial) {
            const cleanSerial = serial.trim();
            if (BLACKLIST.includes(cleanSerial)) {
                statusText.innerText = "ðŸš¨ CARTA RUBATA!";
                detailsText.innerText = "Seriale " + cleanSerial + " trovato nel database dei furti.";
                resultBox.className = "stolen";
                if (navigator.vibrate) navigator.vibrate([200, 100, 200]);
            } else {
                statusText.innerText = "âœ… CARTA SICURA";
                detailsText.innerText = "Nessuna segnalazione per il seriale " + cleanSerial;
                resultBox.className = "safe";
            }
        }

        // Funzione per il tasto manuale
        function checkManual() {
            const val = manualInput.value;
            if (val.length > 3) {
                checkDatabase(val);
            } else {
                alert("Inserisci un seriale valido");
            }
        }

        // Avvio camera (opzionale se vuoi solo testare il manuale)
        navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } })
            .then(stream => { video.srcObject = stream; })
            .catch(err => console.log("Camera non disponibile"));

    </script>
</body>
</html>
